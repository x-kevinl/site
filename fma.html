<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>F=ma Practice</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 2em auto;
      padding: 0 1em;
    }
    #problem-container {
      text-align: center;
    }
    #exam-label {
      margin-bottom: 0.5em;
      color: gray;
      font-style: italic;
    }

    /* THE NEW “ONE BOX” AROUND ALL IMAGE PARTS */
    #image-wrapper {
      border: 2px solid #000;    /* darker, “blacker” box */
      padding: 0.5em;
      margin: 0 auto 1em;
      display: inline-block;     /* shrink-wrap to the images */
      width: 100%;               /* or a % you like (e.g. 90%) */
      box-sizing: border-box;
    }

    /* images now just fill the wrapper, no individual border */
    .problem-image {
      display: block;
      width: 100%;
      height: auto;
      margin-bottom: 1em;
      border: none;
    }

    #answer-box {
      margin-top: 1em;
    }
    #answer-box input {
      width: 60%; padding: 0.5em; font-size: 1em;
      text-transform: uppercase;
    }
    #answer-box button {
      padding: 0.5em 1em; font-size: 1em; margin-left: 0.5em;
    }
    #feedback {
      margin-top: 1em; font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="problem-container">
    <h1>F=ma Practice Problem</h1>
    <div id="exam-label"></div>
    <div id="image-wrapper"></div>

    <div id="answer-box">
      <label for="answer">Your answer (A–E):</label>
      <input type="text" id="answer" maxlength="1" />
      <button id="submit-btn">Submit</button>
    </div>
    <div id="feedback"></div>
  </div>

  <script>
    const config = {
      exams: ['2022A','2022B','2023','2024'],
      maxProblems: { '2022A':25, '2022B':25, '2023':25, '2024':25 }
    };

    let currentExam, currentNum, answerLines = [];

    async function fetchImageParts(exam, num) {
      const base = `/static/images/fma/${exam}/${num}`;
      const ext  = '.webp';
      const parts = [];
      for (let sfx of ['a','b']) {
        const url = base + sfx + ext;
        try { if ((await fetch(url,{method:'HEAD'})).ok) parts.push(url); }
        catch{}
      }
      if (!parts.length) {
        const url = base + ext;
        try { if ((await fetch(url,{method:'HEAD'})).ok) parts.push(url); }
        catch{}
      }
      return parts;
    }

    async function loadRandomProblem() {
      currentExam = config.exams[Math.floor(Math.random()*config.exams.length)];
      currentNum  = Math.floor(Math.random()*config.maxProblems[currentExam]) + 1;

      document.getElementById('exam-label').textContent = `Exam ${currentExam}`;

      const wrapper = document.getElementById('image-wrapper');
      wrapper.innerHTML = '';
      const imgs = await fetchImageParts(currentExam, currentNum);
      imgs.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.alt = `F=ma ${currentExam} #${currentNum}`;
        img.className = 'problem-image';
        wrapper.appendChild(img);
      });

      document.getElementById('answer').value = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('submit-btn').textContent = 'Submit';

      try {
        const keyTxt = await (await fetch(
          `/static/images/fma/${currentExam}/key.txt`
        )).text();
        answerLines = keyTxt
          .split(/\r?\n/)
          .map(l => l.trim().toUpperCase())
          .filter(l => l);
      } catch {
        answerLines = [];
      }
    }

    window.addEventListener('DOMContentLoaded', loadRandomProblem);

    document.getElementById('submit-btn').addEventListener('click', async function() {
      const btn = this;
      const fb  = document.getElementById('feedback');
      const ans = document.getElementById('answer').value.toUpperCase().trim();

      if (btn.textContent === 'Submit') {
        if (!/^[A-E]$/.test(ans)) {
          fb.textContent = 'Please enter A, B, C, D, or E.';
          fb.style.color = 'darkorange';
          return;
        }
        const raw     = answerLines[currentNum-1]||'';
        const correct = raw.split('').filter(c=>/[A-E]/.test(c));

        if (correct.includes(ans)) {
          fb.textContent = '✅ Correct!';
          fb.style.color = 'green';
        } else {
          const plural = correct.length>1;
          fb.textContent = `❌ Incorrect — the right answer${plural?'s are':' is'} ${correct.join(' & ')}.`;
          fb.style.color = 'red';
        }
        btn.textContent = 'Next Question';
      } else {
        await loadRandomProblem();
      }
    });
  </script>
</body>
</html>
