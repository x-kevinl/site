<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>F=ma Practice</title>
<style>
  body {
    font-family: sans-serif;
    /* bump this up (or remove it entirely) so the page can be wider */
    max-width: 800px;
    margin: 2em auto;
    padding: 0 1em;
  }

  #problem-container {
    text-align: center;
  }

  #problem-image {
    display: block;          /* so margin:0 auto works */
    margin: 0 auto 1em;      /* center horizontally + 1em bottom gap */
    width: 100%;             /* fill the container width */
    max-width: 100%;         /* never exceed it */
    height: auto;            /* maintain aspect ratio */
    border: 1px solid #ccc;
  }

  #answer-box {
    margin-top: 1em;
  }
  #answer-box input {
    width: 60%;
    padding: 0.5em;
    font-size: 1em;
    text-transform: uppercase;
  }
  #answer-box button {
    padding: 0.5em 1em;
    font-size: 1em;
    margin-left: 0.5em;
  }
  #feedback {
    margin-top: 1em;
    font-weight: bold;
  }
</style>

</head>
<body>
  <div id="problem-container">
    <h1>F=ma Practice Problem</h1>
    <img id="problem-image" src="" alt="F=ma problem" />
    <div id="answer-box">
      <input type="text" id="answer" name="answer" maxlength="1" />
      <button id="submit-btn">Submit</button>
    </div>
    <div id="feedback"></div>
  </div>

  <script>
    const config = {
      years: [2023, 2024],
      maxProblems: { 2023: 25, 2024: 25 }
    };

    let currentYear, currentNum, answerLines = [];

    async function loadRandomProblem() {
      currentYear = config.years[Math.floor(Math.random() * config.years.length)];
      currentNum  = Math.floor(Math.random() * config.maxProblems[currentYear]) + 1;

      // Display the problem image
      const img = document.getElementById('problem-image');
      img.src = `/static/images/fma/${currentYear}/${currentNum}.webp`;
      img.alt = `F=ma ${currentYear} Problem ${currentNum}`;

      // Clear previous input/feedback and reset button
      document.getElementById('answer').value = "";
      const fb = document.getElementById('feedback');
      fb.textContent = "";
      fb.style.color = "";
      document.getElementById('submit-btn').textContent = "Submit";

      // Fetch and split key.txt
      try {
        const resp = await fetch(`/static/images/fma/${currentYear}/key.txt`);
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const text = await resp.text();
        answerLines = text
          .split(/\r?\n/)
          .map(line => line.trim().toUpperCase())
          .filter(line => line);
      } catch (err) {
        console.error("Failed to load key:", err);
        answerLines = [];
      }
    }

    window.addEventListener('DOMContentLoaded', loadRandomProblem);

    document.getElementById('submit-btn').addEventListener('click', async function() {
      const btn = this;
      const fb  = document.getElementById('feedback');
      const userAns = document.getElementById('answer').value.toUpperCase().trim();

      if (btn.textContent === "Submit") {
        // Validate input
        if (!/^[A-E]$/.test(userAns)) {
          fb.textContent = "Please enter A, B, C, D, or E.";
          fb.style.color = "darkorange";
          return;
        }
        if (answerLines.length < currentNum) {
          fb.textContent = "Answer key not available for this problem.";
          fb.style.color = "gray";
          return;
        }

        // Check against correct answers (e.g. "BC" → ["B","C"])
        const raw = answerLines[currentNum - 1];
        const correctArr = raw.split('').filter(ch => /[A-E]/.test(ch));

        if (correctArr.includes(userAns)) {
          fb.textContent = "✅ Correct!";
          fb.style.color = "green";
        } else {
          const plural = correctArr.length > 1;
          fb.textContent = `❌ Incorrect — the right answer${plural ? 's are' : ' is'} ${correctArr.join(' & ')}.`;
          fb.style.color = "red";
        }

        // Switch to next-question mode
        btn.textContent = "Next Question";

      } else {
        // Next Question: load a new one
        await loadRandomProblem();
      }
    });
  </script>
</body>
</html>
